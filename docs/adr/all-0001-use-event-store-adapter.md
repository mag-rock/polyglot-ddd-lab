# ADR all-0001: event-store-adapter を採用する

- 日付: 2025-11-26
- ステータス: 承認
- 決定者: プロジェクトチーム（学習者承認前提）

## 背景
- 本プロジェクトは Kotlin / Go / Rust / TypeScript で同一ドメインを実装し、言語差分を比較することが目的。
- イベント駆動アーキテクチャを採用するため、イベントストアの扱いを各言語で統一したい。
- ライブラリ習得コストを抑え、共通のインターフェースで実装を再利用できることが望ましい。
- j5ik2o 氏による event-store-adapter が複数言語で提供されており、イベントソーシング/ストリーム処理の知見が反映されている。

## 決定
- 各言語実装で event-store-adapter を採用する。
  - Kotlin: https://github.com/j5ik2o/event-store-adapter-kotlin
  - ほか言語: https://github.com/j5ik2o/event-store-adapter
- コアのイベントストア操作（ストリームの追加・読取・プロジェクション基盤）は同ライブラリの API に依拠し、各言語での実装方針を揃える。
- ストレージ実体（例: PostgreSQL）の選択/接続は各言語版の推奨構成に従う。

## 選定理由
- マルチランゲージで API が整備されており、ドメイン層のコード/テストの移植性が高い。
- イベントストアやプロジェクションまわりの抽象化が揃っており、ライブラリ学習コストを低減できる。
- DDD/イベント駆動の実践者による設計で、ガイドに従うことで実装リスクを減らせる。
- 既存 OSS を活用し、インフラ/データレイヤの自前実装や運用負荷を抑えられる。

## トレードオフ・懸念
- ライブラリのメンテナンス状況に依存する。アップデート追従の運用コストが発生する。
- 設計をライブラリの抽象に寄せるため、将来別製品への移行時に適合コストが発生する可能性がある。
- 各言語版で成熟度や API の差異がある場合、コード共通化に追加対応が必要。

## 影響範囲
- イベントストアの CRUD/ストリーム処理、プロジェクション/リプレイの API 設計。
- ドメインイベントの永続化フォーマットとメタデータ管理。
- インフラ層の接続設定（PostgreSQL 等）とマイグレーション。

## 採用後の TODO
- Kotlin 版の最小 PoC を作成し、予約作成/キャンセルイベントの永続化と読み取りモデル更新を通す。
- 推奨ストレージ（例: PostgreSQL + JSONB）とスキーママイグレーション方針を確定する。
- 各言語での API 使い方の差分をまとめ、ドメインコードで参照するインターフェースを最小限に定義する。
- イベント ID/バージョン/メタデータ（トレースID等）の標準フォーマットを決め、共通テストケースを用意する。
